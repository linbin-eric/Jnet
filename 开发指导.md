# 目标

1. HttpClient 从静态调用，修改为实例，这样方便在 HttpClient 上设置公共的属性。实例自己持有连接池。

# 核心思路

1. **将 HttpClient 从接口改为类**：当前 `HttpClient` 是一个接口，包含静态的连接池和静态方法。需要改为实例类，每个实例持有自己的连接池和配置。

2. **集成 HttpClientConfig 配置类**：使用已存在的 `HttpClientConfig` 类来配置 HttpClient 实例，包括超时时间、连接数限制、TrustManager 等。

3. **修改 HttpConnectionPool 支持配置**：连接池需要接收配置参数，而不是使用硬编码的默认值。

4. **修改 HttpConnection 支持配置**：连接创建时需要使用配置中的参数（如 TrustManager、超时时间等）。

5. **自动识别 HTTP/HTTPS**：根据请求 URL 的 scheme 自动决定是否启用 SSL 连接。

6. **保持 API 兼容性**：提供便捷的静态方法作为默认实例的快捷方式，降低迁移成本。

# 详细思路

## 1. 修改 HttpUrl 类，暴露 scheme 信息

当前 `HttpUrl` 是一个 record 类，包含 `domain`、`port`、`path`、`hostHeader` 四个字段。在 `parse` 方法中已经解析了 `isHttps`，但没有暴露出来。

**改动**：在 `HttpUrl` record 中新增 `boolean ssl` 字段，用于标识是否为 HTTPS 请求。

## 2. 修改 HttpRequest 类，存储 ssl 信息

`HttpRequest` 是用户构建请求的入口，在调用 `setUrl()` 时会解析 URL。将 ssl 信息存储在 `HttpRequest` 中更符合职责划分（`HttpRequestPartHead` 只负责 HTTP 协议层的数据）。

**改动**：在 `HttpRequest` 中新增 `boolean ssl` 字段，并在 `setUrl()` 方法中从 `HttpUrl` 获取并保存。后续 `HttpClient` 从 `HttpRequest` 获取 ssl 信息。

## 3. 修改 HttpConnectionPool，支持配置参数

当前 `HttpConnectionPool` 使用硬编码的默认值：
- `DEFAULT_MAX_CONNECTIONS_PER_HOST = 50`
- `DEFAULT_TIMEOUT_SECONDS = 1`
- `KEEP_ALIVE_SECONDS = 1800`

**改动**：
- 将 `HttpConnectionPool` 改为接收 `HttpClientConfig` 作为构造参数
- 修改 `borrowConnection` 方法，支持传入 `ssl` 参数，以便创建 SSL 连接
- 连接池的 key 需要区分 HTTP 和 HTTPS（同一 host:port 可能同时有 HTTP 和 HTTPS 连接）

## 4. 修改 HttpConnection，支持配置参数

当前 `HttpConnection` 的 SSL 构造方法中 `TrustManager` 是硬编码的（信任所有证书）。

**改动**：
- 新增接收 `HttpClientConfig` 的构造方法
- SSL 初始化时使用配置中的 `TrustManager`（如果配置为 null 则使用默认的信任所有证书）
- SSL 握手超时使用配置中的 `sslHandshakeTimeoutSeconds`

## 5. 将 HttpClient 从接口改为类

当前 `HttpClient` 是一个接口，包含：
- 静态字段 `CONNECTION_POOL`
- 静态方法 `newCall()` 和 `newStreamCall()`

**改动**：
- 将 `HttpClient` 改为普通类
- 新增实例字段：`HttpClientConfig config` 和 `HttpConnectionPool connectionPool`
- 提供构造方法：无参构造（使用默认配置）和接收 `HttpClientConfig` 的构造方法
- 将静态方法改为实例方法
- 在方法中自动从 `HttpRequest` 获取 `ssl` 字段，决定是否创建 SSL 连接
- 保留静态的默认实例和静态便捷方法，保持向后兼容

## 6. 使用配置中的超时参数

当前 `HttpClient.newCall()` 中超时时间是硬编码的 60 秒。

**改动**：
- 使用 `HttpClientConfig.readTimeoutSeconds` 作为读取超时
- 使用 `HttpClientConfig.acquireTimeoutSeconds` 作为获取连接超时